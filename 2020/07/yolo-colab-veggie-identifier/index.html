<!DOCTYPE html><html lang="en"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1"><title>Updating su_chef object detection with custom trained model | bonkerfield</title><meta name="description" content="just your standard information identity spacetime field"><meta itemprop="name" content="will stedden"><meta itemprop="description" content="building a custom trained yolov3 model for vegetable detection"><meta itemprop="image" content="https://bonkerfield.org/assets/images/2020/yolo_veggie_still.png"><meta property="og:url" content="https://bonkerfield.org/2020/07/yolo-colab-veggie-identifier/"><meta property="og:type" content="website"><meta property="og:title" content="Updating su_chef object detection with custom trained model | bonkerfield"><meta property="og:site_name" content="bonkerfield"><meta property="og:description" content="building a custom trained yolov3 model for vegetable detection"><meta property="og:image" content="https://bonkerfield.org/assets/images/2020/yolo_veggie_still.png"><meta property="twitter:url" content="https://bonkerfield.org/2020/07/yolo-colab-veggie-identifier/"><meta property="twitter:card" content="summary_large_image"/><meta property="twitter:title" content="Updating su_chef object detection with custom trained model | bonkerfield"><meta property="twitter:site" content="bonkerfield"><meta property="twitter:description" content="building a custom trained yolov3 model for vegetable detection"><meta property="twitter:image" content="https://bonkerfield.org/assets/images/2020/yolo_veggie_still.png"><link rel="icon" type="image/x-icon" href="/assets/images/favicon.ico"><link rel="stylesheet" href="/assets/css/app.min.css"><link rel="alternate" type="application/rss+xml" title="bonkerfield" href="/feed.xml"><link rel="canonical" href="/2020/07/yolo-colab-veggie-identifier/"><link href="https://fonts.googleapis.com/css?family=Exo" rel="stylesheet"><link rel="webmention" href="https://webmention.io/bonkerfield.org/webmention" /><link rel="pingback" href="https://webmention.io/bonkerfield.org/xmlrpc" /> <script async src="https://www.googletagmanager.com/gtag/js?id=UA-132451521-2"></script> <script> window.dataLayer = window.dataLayer || []; function gtag(){dataLayer.push(arguments);} gtag('js', new Date()); gtag('config', 'UA-132451521-2'); </script><link href='https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.13.0/css/all.min.css' rel='stylesheet'/></head><body id="updating-su-chef-object-detection-with-custom-trained-model" class="post-layout"><header class="header"> <span><a class="header__title" href="/">bonkerfield</a></span><nav><ul class="header__list"><li><a href="/fiction">fiction</a></li><li><a href="/projects">projects</a></li><li><a href="/essays">essays</a></li><li><a href="/reasons">about</a></li><li><a href="https://viewfoil.bonkerfield.org/">contact</a></li><li><a href="/search"><i class="fa fa-search"></i></a></li></ul></nav></header><a style="display:none;" class="p-author h-card" href="http://bonkerfield.org"> <img alt="" src="/assets/images/main/face_prof.jpg"/> will stedden</a><main class="bonk"><div class="post"><article class="h-entry" itemprop="blogPost" itemscope itemtype="http://schema.org/BlogPosting"><div class="post__header section-padding-half"><div class="grid-small"><h2 itemprop="name headline p-name">Updating su_chef object detection with custom trained model</h2><time class="post__date dt-published" datetime="2020-07-23T00:00:00-05:00" itemprop="datePublished">2020·07·23</time> <span class="post__author"> | <a class="p-name u-url" href="http://will.stedden.org" title="about">will stedden</a> </span><p class="post__description p-summary">building a custom trained yolov3 model for vegetable detection</p><a class="u-url" style="display:none;" href="https://bonkerfield.org/2020/07/yolo-colab-veggie-identifier/"></a></div></div><div class="post__content section-padding"><div class="grid"><div class="e-content" id="markdown" itemprop="articleBody"><p>As part of my <a href="/su_chef.html">su_chef project</a>, I needed to expand the camera object detection model to include more classes that I am interested in. Originally, I was using the standard YOLOv3 weights file from <a href="https://pjreddie.com/darknet/yolo/">pjreddie's original</a>. That model has 80 classes that it can identify, but unfortunately, most of them weren't really useful for my use case of finding and picking up fruits and vegetables.</p><p>So last weekend, I learned how to fine-tune a YOLOv3 model using my own custom image dataset. It would be impractically slow to train the neural net on my personal computer without a GPU so I used Google Colab to train using their free GPUs.</p><p>For the code, I packaged up a <a href="https://github.com/lots-of-things/yolo-colab-simple">tutorial repo</a> (based on <a href="https://github.com/kriyeng/yolo-on-colab-notebook ">this one</a>) that pulls in training data from Google Drive, trains, and then stores trained model directly back into my Google Drive. I also included my example data and a test script to make it easier for others. If you want to try it yourself or adapt it, clone <a href="https://github.com/lots-of-things/yolo-colab-simple">the repo</a>, copy it to your Google Drive, and follow the instructions in the <code>README.md</code> file.</p><p>Read on to see how it performed for my task.</p><h4>Initial Results</h4><p>To start, I just used some previously annotated data from Google's <a href="https://storage.googleapis.com/openimages/web/visualizer/index.html?set=train&type=detection&c=%2Fm%2F0jg57">OpenImages project</a> to get a dataset that includes apples, tomatoes, and bell peppers. After training for 2500 iterations it was doing a fair job at distinguishing between the three on example images like this.</p><img src="/assets/images/2020/yolo_first_results.png" alt="Apple Tomato and Bell Pepper properly distinguished by YOLO model" /><p>Importantly, because I'm using the Darknet implementation, detection still works in near real-time even on my crappy CPU machine. I incorporated this new model into my <a href="https://github.com/lots-of-things/ros_braccio_opencv_obj_detect_grab">ros_braccio_opencv_obj_detect_grab repo</a> and ran just the detection subroutine. It does a decent job of distinguishing between the three.</p><img src="/assets/images/2020/apple_pepper_tomato_realtime.gif" alt="Apple Tomato and Bell Pepper properly distinguished by YOLO model" /><p>It isn't quite perfect though, particularly with distinguishing the bell pepper from the tomato. And when I use the new model with the overhead cam and try to pick things up, the performance is markedly worse. Particularly, as shown in this example, the apple is almost always identified as a tomato and the tomato is often mistaken for bell pepper.</p><img src="/assets/images/2020/yolo_fail.gif" alt="YOLO model failing and misidentifying objects" /><p>Overall, this made the results unsatisfactory. I kept training for more than 3k iterations but the avg loss had stopped improving on the test set, and there wasn't a noticeable improvement. I could take some time and quantify this, but I'm not writing a paper here, I'm just trying to pick up some veggies. I suspect the main failure is coming from the difference between my training data and the images that the overhead cam is providing since the annotated images are much higher quality than webcam images in my actual setup.</p><h4>Adding more and better training data</h4><p> To improve my performance I've begun adding more manually annotated data. During this process I learned something about myself.</p><blockquote class="twitter-tweet"><p lang="en" dir="ltr">You know you&#39;ve found a machine learning project you love when you are willing to annotate your own data.</p>&mdash; Will Stedden (@bonkerfield) <a href="https://sigmoid.social/@bonkerfield/status/1288267178672705536?ref_src=twsrc%5Etfw">July 29, 2020</a></blockquote><script async src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p> I took pictures directly from the overhead cam using the fruits and vegetables that we had in the house. Even after just adding just 40 images and retraining for 2k more iterations, I'm seeing some qualitative improvement. Here's a hand-picked (pun intended) example.</p><img src="/assets/images/2020/yolo_custom_data.png" alt="Comparison of YOLOv3 object detection of apples before and after training with custom data. Before: 4 apples are detected as tomato. After: 2 are detected as apple and other two are missed." /><p> There will always be room for improvement on this type of model, but this is good enough for me for now. I'll continue fine-tuning as needed.</p><h4>Next steps</h4><p> At least for now, this lets me update my pickup script to allow targeting of specific objects, which will enable the next phase. As outlined in <a href="/2020/07/su-chef-braccio-yolo/">my last post</a>, the next steps are going to be building my veggie slicer and moving around bowls under the slicer. I've already started on the design of the slicer and I hope to spin that up by end of next week.</p></div></div></div><div class="section-padding--none"><div class="grid"><hr class="sep" /></div></div><div class="section-padding"><div class="grid-small"><h3 class="post__discussion">Discussion Around the <a href="https://indieweb.org/Webmention">Web</a></h3><div id="webmentions"></div><hr style="margin: 5px 0;" class="sep" /><p>Join the Conversation</p><form target="_blank" name="tweet" action="https://twitter.com/share" method="get"> <input type="hidden" name="original_referer" value="https://bonkerfield.org/2020/07/yolo-colab-veggie-identifier/"> <input type="hidden" name="source" value="bonkerfield"> <textarea style="border-color:#aaa;" id="textar" name="text" maxlength="140"></textarea> <input type="hidden" name="url" value="https://bonkerfield.org/2020/07/yolo-colab-veggie-identifier/"> <button class="btn btn-sm btn-social btn-tw" type="submit" id="button"> <i class="fab fa-twitter"></i> <br/>comment by tweet </button> </form><hr style="margin: 5px 0;" class="sep" /> <form target="_blank" name="tweet" action="https://www.reddit.com/submit" method="get"> <input type="hidden" name="source" value="bonkerfield"> <textarea style="border-color:#aaa;" id="textar" name="title" maxlength="140"></textarea> <button class="btn btn-sm btn-social btn-rd" type="submit" id="button"> <i class="fab fa-reddit-alien"></i> <br/>submit to reddit </button> <input type="hidden" name="url" value="https://bonkerfield.org/2020/07/yolo-colab-veggie-identifier/"> </form> <script src="/assets/js/webmention.min.js"></script></div></div></article></div><section class="related section-padding"><div class="grid-xlarge"><h2 class="related__title">Related</h2><div class="related__container"><article class="related__post"> <a class="related__link" href="https://bonkerfield.org/2020/09/su-chef-slices/"><figure class="related__img"> <img src="/assets/images/2020/suchef_overhead.jpg" alt="su_chef slices" /></figure><div><h2 class="related__text">su_chef slices</h2></div></a></article><article class="related__post"> <a class="related__link" href="https://bonkerfield.org/2020/08/braccio-moveit-gazebo/"><figure class="related__img"> <img src="/assets/images/2020/braccio_pick_demo.gif" alt="Simulating the Braccio robotic arm with ROS and Gazebo" /></figure><div><h2 class="related__text">Simulating the Braccio robotic arm with ROS and Gazebo</h2></div></a></article><article class="related__post"> <a class="related__link" href="https://bonkerfield.org/2020/07/yolo-colab-veggie-identifier/"><figure class="related__img"> <img src="/assets/images/2020/yolo_veggie_still.png" alt="Updating su_chef object detection with custom trained model" /></figure><div><h2 class="related__text">Updating su_chef object detection with custom trained model</h2></div></a></article></div></div></section></main><footer class="footer section-padding"><div class="grid"><div class="subscribe" id="subscribe"><div class="subscribe__container"> <span class="subscribe__title">Subscribe</span><p class="subscribe__text">Get an update when I post new content.</p><form method="POST" action="https://bonkerfield.us4.list-manage.com/subscribe/post-json?u=68d1146ea8fe327def203f254&amp;id=e88ba623c5&amp;c=?" id="mc-signup" name="mc-embedded-subscribe-form" novalidate><div style="position: absolute; left: -5000px;" aria-hidden="true"> <input type="text" name="b_68d1146ea8fe327def203f254_e88ba623c5" tabindex="-1" value=""></div><div class="form-group"> <input id="mce-EMAIL" type="email" name="EMAIL" placeholder="Email Address"></div><div class="form__btn"> <input id="mc-submit" type="submit" value="Sign Up" name="subscribe"></div></form><p class="subscribe__error hidden"></p></div></div><hr class="sep--white"/><div class="footer__container"><ul class="footer__social"><li><a href="https://sigmoid.social/@bonkerfield" rel="me" target="_blank"><i class="fab fa-mastodon"></i></a></li><li><a href="https://www.linkedin.com/in/willstedden" rel="me" target="_blank"><i class="fab fa-linkedin"></i></a></li><li><a href="https://github.com/stedn" rel="me" target="_blank"><i class="fab fa-github"></i></a></li><li><a href="https://www.reddit.com/user/bonkerfield" rel="me" target="_blank"><i class="fab fa-reddit-alien"></i></a></li></ul><div style="text-align:center;"> <a style="margin:20px;color:white;" target="_blank" href="https://opencollective.com/bonkerfield"><div class="form__btn" style="text-align:center;padding:10px;"> Support on OpenCollective</div></a></div><div class="posts__pagination"> <span>This site is maintained by <a href="https://will.stedden.org">Will Stedden</a>. All content on this blog is free to use under a creative commons <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a> license</span>. The thoughts behind this content may be used under the terms of Will's <a href="https://will.stedden.org/lisens">'lisens'</a>.</div></div></div></footer><script src="/assets/js/app.min.js"></script> <script> (function() { var links = document.getElementsByTagName('a'); for (var i = 0; i < links.length; i++) { if (/^(http?:)?\/\//.test(links[i].getAttribute('href'))) { links[i].target = '_blank'; } } })(); </script></body></html>
  